<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0, viewport-fit=cover" />
  <title>Orbs.cure✨</title>

  <!-- site CSS -->
  <link rel="stylesheet" href="css/style.css">

  <!-- A-Frame + environment component -->
  <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-environment-component@1.3.4/dist/aframe-environment-component.min.js"></script>
</head>
<body>
  <!-- ======= HTML UI (OUTSIDE a-scene) ======= -->
  <!-- HUD (top-left) -->
  <div id="hud" role="region" aria-label="game heads up display">
    <span>Score: <strong id="scoreVal">0</strong></span>
    <span style="margin:0 8px">|</span>
    <span>Time: <strong id="timeVal">360</strong>s</span>
    <button id="openMenuBtn" title="Open Settings" aria-haspopup="dialog">Settings</button>
  </div>

  <!-- Toast messages (bottom center) -->
  <div id="toast" aria-live="polite" role="status" hidden></div>

  <!-- Central Menu Overlay (visible on load) -->
  <div id="menuOverlay" role="dialog" aria-modal="true" aria-hidden="false">
    <h2>Orbs.cure — Settings & Play</h2>

    <div class="field">
      <label for="orbGazeInput">Orb gaze time (ms)</label>
      <input id="orbGazeInput" type="number" min="50" step="50" value="150">
    </div>

    <div class="field">
      <label for="dangerGazeInput">Danger gaze time (ms)</label>
      <input id="dangerGazeInput" type="number" min="50" step="50" value="500">
    </div>

    <div class="buttons-row">
      <button id="startGameBtn" class="primary">Start Game</button>
      <button id="saveSettings">Save</button>
      <button id="restartBtn">Restart</button>
    </div>

    <hr>

    <!-- AR + VR controls placed here as requested -->
    <div class="buttons-row">
      <button id="enterARBtn" style="display:none">Enter AR</button>
      <button id="enterVRBtn" title="Enter VR">Enter VR</button>
    </div>

    <div id="arStatus" aria-live="polite" class="status-line"></div>
  </div>

  <!-- MUSIC CONTROLS (insert inside #menuOverlay, e.g. after the .row buttons) -->
<hr style="border:none;border-top:1px solid rgba(255,255,255,0.06);margin:10px 0;" />
<div style="text-align:left;margin-top:6px;">
  <label style="font-size:13px;margin-bottom:6px;display:block;">Background Music</label>
  <div style="display:flex;gap:8px;align-items:center;">
    <button id="prevTrack" class="menu-btn small">⟨</button>
    <button id="playPauseMusic" class="menu-btn small">Play</button>
    <button id="nextTrack" class="menu-btn small">⟩</button>
    <select id="bgSelect" style="flex:1;padding:6px;border-radius:6px;background:#0f1520;color:#fff;border:1px solid #333;">
      <option value="bg1.mp3">Cornfield Chase</option>
      <option value="bg2.mp3">Running Out</option>
      <option value="bg3.mp3">Stay</option>
      <option value="bg4.mp3">Coward</option>
      <option value="bg5.mp3">S.T.A.Y</option>
      <option value="bg6.mp3">Wormhole</option>
      <option value="bg7.mp3">Dust</option>
      <option value="bg8.mp3">Detach</option>
      <option value="bg9.mp3">Mountains</option>
      <option value="bg10.mp3">Where We're Going</option>
      <option value="bg11.mp3">Day One</option>
      <option value="bg.mp3">Afraid of Time</option>
    </select>
  </div>
  
  <div style="display:flex;align-items:center;gap:10px;justify-content:space-between;">
        <div class="music-nowplaying" id="nowPlaying">Now: —</div>
  <div style="display:flex;align-items:center;gap:8px;margin-top:8px;">
    <label for="musicVol" style="font-size:12px;margin-right:6px;">Volume</label>
    <input id="musicVol" type="range" min="0" max="1" step="0.01" value="0.6" style="width:160px;" aria-label="Music volume" />
    <span id="musicLabel" style="width:40px;text-align:right;font-weight:700;color:#dbefff;">50%</span>
  </div>
    <!-- end music block -->
</div> <!-- end #menuOverlay -->

  <!-- ======= A-Frame Scene (3D canvas) ======= -->
  <a-scene
  id="scene"
  renderer="antialias: true; alpha: true"
  background="color: transparent"
  vr-mode-ui="enabled: false"
  embedded
>
    <a-assets>
      <!-- audio assets -->
      <audio id="collectSound" src="assets/audio/click.ogg"></audio>
      <audio id="dangerSound" src="assets/audio/explosion.ogg"></audio>
    </a-assets>

    <!-- Environment (grid/starry preset preserved) -->
    <a-entity environment="preset: starry; skyType: atmosphere; groundColor: #0a1a2a; groundTexture: walkernoise; ground: canyon; fog: 0.08; lightPosition: 0 8 -3; dressing: stones; dressingAmount: 10; dressingColor: #223a57"></a-entity>

    <!-- Camera rig -->
    <a-entity id="rig" position="0 1.6 0">
      <a-entity id="camera" camera look-controls>
        <!-- gaze reticle visible in VR -->
        <a-ring id="reticle" position="0 0 -0.9" radius-inner="0.008" radius-outer="0.016" color="#bfe5ff"></a-ring>

        <!-- raycaster used for gaze interactions -->
        <a-entity id="ray" raycaster="objects: .interactable; interval: 40"></a-entity>

        <!-- small in-head HUD -->
        <a-entity position="-0.42 0.32 -1">
          <a-plane width="0.36" height="0.14" color="#000" material="opacity:0.35"></a-plane>
          <a-text id="vrScore" value="Score: 0" color="#fff" position="-0.16 -0.02 0.01" width="1.2"></a-text>
        </a-entity>
      </a-entity>
    </a-entity>

    <!-- spawners -->
    <a-entity id="collect-spawner"></a-entity>
    <a-entity id="danger-spawner"></a-entity>

    <!-- AR reticle (moved via hit-test) -->
    <a-entity id="arReticle" visible="false"
              geometry="primitive: ring; radiusInner: 0.05; radiusOuter: 0.08"
              material="color:#0ff; shader: flat; opacity:0.8" rotation="-90 0 0"></a-entity>

    <!-- Game over panel (in-scene) -->
    <a-entity id="gameOverPanel" visible="false">
      <a-entity position="0 1.4 -1.2">
        <a-plane width="1.0" height="0.5" color="#200" material="opacity:0.95"></a-plane>
        <a-text id="gameOverText" value="GAME OVER" color="#fff" position="-0.4 0.12 0.01" width="2"></a-text>
      </a-entity>
    </a-entity>
  </a-scene>

  <!-- JS: game logic first, then AR helper -->
  <script src="js/vr-game.js"></script>
  <script src="js/ar-hit-test.js"></script>

  <!-- small fallback notice for non-JS -->
  <noscript>
    <div style="position:fixed;left:12px;bottom:12px;background:#111;padding:8px;border-radius:6px;color:#fff;z-index:99999">
      JavaScript disabled — the game requires JS to run.
    </div>
  </noscript>
</body>
    </html>
